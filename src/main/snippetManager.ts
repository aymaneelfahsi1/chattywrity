import * as fs from 'fs';import * as path from 'path';import { app } from 'electron';interface Snippet {    id: string;    trigger: string;    expansion: string;    description?: string;}interface SnippetData {    snippets: Snippet[];}export class SnippetManager {    private snippets: Snippet[];    private dataPath: string;    constructor() {        this.dataPath = path.join(app.getPath('userData'), 'snippets.json');        this.snippets = this.load();    }    private load(): Snippet[] {        try {            if (fs.existsSync(this.dataPath)) {                const data = fs.readFileSync(this.dataPath, 'utf-8');                const parsed = JSON.parse(data) as SnippetData;                return parsed.snippets || [];            }        } catch (error) {        }        return [            {                id: '1',                trigger: 'my email',                expansion: 'your.email@example.com',                description: 'Insert my email address'            },            {                id: '2',                trigger: 'sign off',                expansion: 'Best regards,\n[Your Name]',                description: 'Email signature'            },            {                id: '3',                trigger: 'phone number',                expansion: '+1 (555) 123-4567',                description: 'Insert my phone number'            }        ];    }    private save(): void {        try {            const dir = path.dirname(this.dataPath);            if (!fs.existsSync(dir)) {                fs.mkdirSync(dir, { recursive: true });            }            const data: SnippetData = { snippets: this.snippets };            fs.writeFileSync(this.dataPath, JSON.stringify(data, null, 2));        } catch (error) {        }    }    addSnippet(trigger: string, expansion: string, description?: string): Snippet {        const snippet: Snippet = {            id: Date.now().toString(),            trigger: trigger.toLowerCase(),            expansion,            description        };        this.snippets.push(snippet);        this.save();        return snippet;    }    updateSnippet(id: string, updates: Partial<Omit<Snippet, 'id'>>): boolean {        const index = this.snippets.findIndex(s => s.id === id);        if (index === -1) return false;        this.snippets[index] = { ...this.snippets[index], ...updates };        if (updates.trigger) {            this.snippets[index].trigger = updates.trigger.toLowerCase();        }        this.save();        return true;    }    removeSnippet(id: string): boolean {        const index = this.snippets.findIndex(s => s.id === id);        if (index === -1) return false;        this.snippets.splice(index, 1);        this.save();        return true;    }    getAllSnippets(): Snippet[] {        return [...this.snippets];    }    findByTrigger(text: string): Snippet | null {        const lowerText = text.toLowerCase();        const exactMatch = this.snippets.find(s =>            lowerText === s.trigger ||            lowerText.includes(s.trigger)        );        return exactMatch || null;    }    applySnippets(text: string): { text: string; applied: Snippet[] } {        let result = text;        const applied: Snippet[] = [];        for (const snippet of this.snippets) {            const regex = new RegExp(`\\b${this.escapeRegex(snippet.trigger)}\\b`, 'gi');            if (regex.test(result)) {                result = result.replace(regex, snippet.expansion);                applied.push(snippet);            }        }        return { text: result, applied };    }    private escapeRegex(str: string): string {        return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');    }    checkForTrigger(text: string): Snippet | null {        const lowerText = text.toLowerCase().trim();        for (const snippet of this.snippets) {            if (lowerText === snippet.trigger) {                return snippet;            }        }        return null;    }}